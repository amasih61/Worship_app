<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Worship App - Emmanuel Church</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Mukta:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a" />

  <style>
    :root {
      color-scheme: dark;
    }

    html {
      font-size: 100%;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #1e293b, #020617);
      color: #e5e7eb;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .hindi-text {
      font-family: 'Mukta', sans-serif;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 999px;
    }

    .glass {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.85));
      backdrop-filter: blur(22px);
      border: 1px solid rgba(148, 163, 184, 0.3);
      transition: background 0.3s ease, border-color 0.3s ease;
      
      /* STABILITY FIX: Forces GPU rendering to prevent white screen glitch */
      -webkit-transform: translate3d(0,0,0);
      transform: translate3d(0,0,0);
      will-change: transform;
    }

    .chip {
      @apply inline-flex items-center rounded-full px-3 py-1 text-xs font-medium border border-slate-600/60 bg-slate-800/60;
    }

    .btn-primary {
      @apply inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold bg-blue-600 hover:bg-blue-500 active:bg-blue-700 text-white transition;
    }

    .btn-danger {
      @apply inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold bg-red-600 hover:bg-red-500 active:bg-red-700 text-white transition;
    }

    .btn-warning {
      @apply inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold bg-yellow-600 hover:bg-yellow-500 active:bg-yellow-700 text-white transition;
    }

    .btn-ghost {
      @apply inline-flex items-center justify-center rounded-xl px-3 py-1.5 text-xs font-medium bg-slate-900/60 hover:bg-slate-800/80 border border-slate-700/70 text-slate-200 transition;
    }

    .badge-pill {
      @apply inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-slate-800/80 text-[0.65rem] text-slate-300 border border-slate-600/70;
    }

    /* LIGHT MODE STYLES */
    body.light-mode {
      background: radial-gradient(circle at top, #e5e7eb, #ffffff);
      color: #0f172a;
    }

    body.light-mode .glass {
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.92), rgba(226, 232, 240, 0.95));
      border-color: rgba(148, 163, 184, 0.6);
    }

    body.light-mode .bg-slate-900\/70 { background-color: #e5e7eb !important; }
    body.light-mode .bg-slate-900\/80 { background-color: #e2e8f0 !important; }
    body.light-mode .bg-slate-800\/80 { background-color: #cbd5f5 !important; }
    body.light-mode .bg-slate-900 { background-color: #e5e7eb !important; }
    body.light-mode .bg-slate-950\/80 { background-color: #f1f5f9 !important; }
    body.light-mode .border-slate-800 { border-color: #cbd5e1 !important; }
    body.light-mode .border-slate-700 { border-color: #cbd5e1 !important; }
    body.light-mode .border-slate-700\/40 { border-color: #cbd5e1 !important; }
    
    body.light-mode .text-slate-100 { color: #020617 !important; }
    body.light-mode .text-slate-200 { color: #0f172a !important; }
    body.light-mode .text-slate-300 { color: #1f2937 !important; }
    body.light-mode .text-slate-400 { color: #4b5563 !important; }
    body.light-mode .text-slate-500 { color: #6b7280 !important; }
    body.light-mode .text-slate-600 { color: #4b5563 !important; }
    body.light-mode .text-slate-700 { color: #374151 !important; }

    body.light-mode .bg-slate-800 { background-color: #e5e7eb !important; }
    body.light-mode .bg-slate-800\/60 { background-color: rgba(148, 163, 184, 0.25) !important; }
    body.light-mode .bg-slate-800\/40 { background-color: rgba(148, 163, 184, 0.2) !important; }
    body.light-mode .bg-slate-700\/60 { background-color: rgba(148, 163, 184, 0.25) !important; }
    
    body.light-mode .bg-slate-900\/95 { background-color: rgba(241, 245, 249, 0.95) !important; }
    body.light-mode .bg-slate-900\/60 { background-color: rgba(241, 245, 249, 0.75) !important; }
    body.light-mode .bg-slate-900\/40 { background-color: rgba(241, 245, 249, 0.55) !important; }
    body.light-mode .bg-slate-900\/30 { background-color: rgba(241, 245, 249, 0.45) !important; }
    body.light-mode .bg-slate-900\/20 { background-color: rgba(241, 245, 249, 0.35) !important; }
    body.light-mode .bg-black\/40 { background-color: rgba(15, 23, 42, 0.12) !important; }
    
    body.light-mode .shadow-lg { box-shadow: 0 18px 40px rgba(15, 23, 42, 0.12); }
    body.light-mode .text-emerald-400, body.light-mode .text-emerald-500 { color: #059669 !important; }
    body.light-mode .bg-emerald-900\/20 { background-color: #dcfce7 !important; }
    body.light-mode .bg-red-900\/20 { background-color: #fee2e2 !important; border-color: #fecaca !important; color: #b91c1c !important; }
    body.light-mode .text-red-400 { color: #dc2626 !important; }

    body.light-mode #favoriteToggle {
      color: #0f172a !important; 
      border-color: #475569 !important;
      background-color: #e2e8f0 !important;
    }
    
    body.light-mode #favoriteToggle.active-fav {
      background-color: #fcd34d !important;
      border-color: #b45309 !important;
      color: #451a03 !important; 
    }
    
    body.light-mode #favoriteToggle.active-fav i {
      color: #b45309 !important;
    }
    
    /* Stronger styling for the Congregation parts */
    .congregation-part {
      font-weight: 700;
      color: #f1f5f9; /* Slate-100 */
      background-color: rgba(30, 41, 59, 0.5); /* Slate-800 with opacity */
      padding: 0.5rem 0.75rem;
      border-radius: 0.5rem;
      border-left: 3px solid #64748b; /* Slate-500 */
      margin-top: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    body.light-mode .congregation-part {
      color: #0f172a;
      background-color: rgba(226, 232, 240, 0.5);
      border-color: #94a3b8;
    }
  </style>
</head>

<body class="min-h-screen text-slate-100 flex flex-col">
  <div class="max-w-4xl mx-auto px-1 py-2 sm:py-4 flex-grow w-full">
    <header class="mb-2 px-1">
      <div class="flex items-center justify-between gap-3">
        <div>
          <h1 class="text-xl sm:text-2xl font-bold tracking-tight flex items-center gap-2">
            <i class="fa-solid fa-church text-blue-400"></i>
            Worship App
          </h1>
          <p class="text-xs sm:text-sm text-slate-400">
            CNI Emmanuel Church, Mirzapur
          </p>
        </div>

        <div class="flex items-center gap-2">
          <button id="themeToggleBtn"
            class="btn-ghost px-3 py-1.5 flex items-center gap-2 rounded-xl border border-slate-600/50">
          </button>

          <button id="installPwaButton" class="btn-install hidden">
            <i class="fa-solid fa-download"></i>
            Install App
          </button>
        </div>
      </div>

      <div
        class="mt-4 grid grid-cols-3 sm:grid-cols-4 gap-2 text-[0.7rem] sm:text-xs font-medium bg-slate-900/70 rounded-2xl p-1 border border-slate-800">
        <button data-screen="home"
          class="tab-btn rounded-xl px-2 py-1.5 flex items-center justify-center gap-1 bg-slate-100 text-slate-900">
          <i class="fa-solid fa-list-ul text-[0.7rem]"></i>
          <span>Songs</span>
        </button>

        <button data-screen="aradhana"
          class="tab-btn rounded-xl px-2 py-1.5 flex items-center justify-center gap-1 text-slate-200">
          <i class="fa-solid fa-hands-praying text-[0.7rem]"></i>
          <span>Aradhana</span>
        </button>

        <button data-screen="prabhuBhoj"
          class="tab-btn rounded-xl px-2 py-1.5 flex items-center justify-center gap-1 text-slate-200">
          <i class="fa-solid fa-bread-slice text-[0.7rem]"></i>
          <span>Prabhu Bhoj</span>
        </button>

        <button data-screen="admin"
          class="tab-btn rounded-xl px-2 py-1.5 flex items-center justify-center gap-1 text-slate-200">
          <i class="fa-solid fa-user-shield text-[0.7rem]"></i>
          <span>Admin</span>
        </button>
      </div>
    </header>

    <main class="glass rounded-2xl shadow-2xl border border-slate-700/70 p-1.5 sm:p-2 bg-slate-900/80">
      <section id="homeScreen" class="space-y-3">
        <div class="flex flex-col sm:flex-row sm:items-center gap-2">
          <div class="flex-1 flex items-center gap-2 bg-slate-950/80 border border-slate-700 rounded-2xl px-3 py-1.5">
            <i class="fa-solid fa-magnifying-glass text-slate-400 text-xs"></i>
            <input id="searchInput" type="text" placeholder="Search by number, Hindi title..."
              class="w-full bg-transparent text-xs sm:text-sm focus:outline-none text-slate-100 placeholder:text-slate-500" />
          </div>

          <button id="favoriteToggle"
            class="inline-flex items-center gap-1 px-3 py-1.5 rounded-2xl text-[0.7rem] border border-yellow-400/40 text-yellow-300 bg-slate-900/70">
            <i class="fa-regular fa-star text-[0.7rem]"></i>
            <span>Favourites</span>
          </button>
        </div>

        <div id="songList" class="mt-2 space-y-2 pr-1">
          <p class="text-xs text-slate-400 text-center mt-6">Loading songs...</p>
        </div>
      </section>

      <section id="songDetailScreen" class="hidden space-y-3">
        <button id="backToListBtn"
          class="inline-flex items-center gap-1 text-[0.7rem] text-slate-400 hover:text-slate-200 mb-1">
          <i class="fa-solid fa-arrow-left-long text-[0.6rem]"></i>
          <span>Back to list</span>
        </button>

        <div class="flex items-start justify-between gap-3">
          <div class="flex-1 min-w-0">
            <div id="songSerial" class="badge-pill mb-1">
              <i class="fa-solid fa-hashtag text-[0.6rem]"></i>
              <span></span>
            </div>
            <h2 id="songTitleHindi" class="hindi-text text-xl font-bold text-slate-100 truncate"></h2>
            <p id="songTitleHinglish" class="text-xs text-slate-400 truncate"></p>
          </div>

          <button id="favoriteSongBtn"
            class="text-xs px-3 py-1.5 rounded-2xl border border-slate-600/70 flex items-center gap-1 text-slate-200">
            <i class="fa-regular fa-star"></i>
            <span>Favourite</span>
          </button>
        </div>

        <div class="mt-1 rounded-2xl bg-slate-950/80 border border-slate-800 px-3 py-3">
          <pre id="lyricsContainer"
            class="hindi-text whitespace-pre-wrap text-base leading-relaxed text-slate-100"></pre>
        </div>
      </section>

      <section id="aradhanaScreen" class="hidden space-y-3 text-sm">
        <h2 class="text-lg font-semibold flex items-center gap-2 text-emerald-400">
          <i class="fa-solid fa-hands-praying"></i>
          Aradhana Order
        </h2>

        <div class="rounded-2xl bg-slate-950/80 border border-slate-800 px-3 py-3 hindi-text text-base leading-relaxed">
          <p class="text-slate-300 text-xs">
            (Aradhana ka existing content yahan rahega – maine sirf Bible part hataya hai.)
          </p>
        </div>
      </section>

      <section id="prabhuBhojScreen" class="hidden space-y-3 text-sm">
        <h2 class="text-lg font-semibold flex items-center gap-2 text-amber-300">
          <i class="fa-solid fa-bread-slice"></i>
          Prabhu Bhoj (Communion)
        </h2>

        <div id="prabhuBhojContent"
          class="rounded-2xl bg-slate-950/80 border border-slate-800 px-3 py-3 hindi-text text-base leading-relaxed space-y-3">
          
          <h2 class="text-xl font-bold mb-4 text-center underline decoration-slate-600 underline-offset-4">प्रभु भोज</h2>

          <p>1. आराधना के आरम्भ में धर्म-सेवक आराधना का आह्वान दे सकता है। (देखिए क्रम संख्या 47)</p>

          <p>2. क्रम-संख्या 1 के पहले या बाद में गीत, स्तुतिगान (कैंटिकल) या भजन संहिता में से एक भजन पढ़ा या गाया जा सकता है।</p>

          <p>3. धर्म-सेवक इन शब्दों में मण्डली का अभिवादन करे —<br>
          प्रभु यीशु मसीह का अनुग्रह, परमेश्वर का प्रेम और पवित्र आत्मा की सहभागिता तुम सब के साथ रहे। (2 कुरि. 13:15)</p>
          
          <div class="congregation-part">
            मण्डली — और आप के साथ भी रहे।
          </div>

          <p>अथवा<br>धर्म सेवक — प्रभु तुम्हारे साथ हो।</p>

          <div class="congregation-part">
            मण्डली — प्रभु आपके साथ भी हो।
          </div>

          <p>4. धर्म सेवक और मण्डली साथ-साथ कहें —</p>
          <div class="congregation-part">
            हे सर्वशक्तिमान परमेश्वर,<br>
            तेरे सम्मुख सब के हृदय खुले हैं,<br>
            तू सब की अभिलाषाओं को जानता है<br>
            और तुझ से कोई भी भेद छिपा नहीं है।<br>
            अपने पवित्र आत्मा की प्रेरणा से…<br>
            हमारे हृदय के विचारों को शुद्ध कर,<br>
            कि हम तुझ से पूर्ण रूप से प्रेम करें<br>
            और योग्य रीति से तेरे पवित्र नाम की स्तुति करें;<br>
            हमारे प्रभु मसीह के द्वारा। आमीन।
          </div>

          <p>5. सब गाएँ या कहें:</p>
          <div class="congregation-part">
            स्वर्ग में परमेश्वर की महिमा<br>
            और पृथ्वी पर उसके लोगों को शांति।<br>
            हे प्रभु परमेश्वर, स्वर्गिक राजा,<br>
            सर्वशक्तिमान पिता परमेश्वर,<br>
            हम तेरी आराधना करते, तुझको धन्यवाद देते,<br>
            और तेरी महिमा के कारण तेरी स्तुति करते हैं।<br>
            हे प्रभु यीशु मसीह, परमेश्वर पिता के एकलौते पुत्र,<br>
            हे प्रभु परमेश्वर, हे परमेश्वर के मेमने,<br>
            तू जगत का पाप उठा ले जाता है,<br>
            हम पर दया कर।<br>
            तू पिता के दाहिने ओर विराजमान है,<br>
            हमारी प्रार्थना स्वीकार कर।<br>
            क्योंकि केवल तू ही पवित्र है,<br>
            तू ही प्रभु है,<br>
            तू ही, हे यीशु मसीह, पवित्र आत्मा के साथ,<br>
            परमेश्वर पिता की महिमा में परम उच्च है। आमीन।
          </div>

          <p>अथवा दया-याचना</p>
          <p>धर्मसेवक — प्रभु, हम पर दया कर।</p>
          <div class="congregation-part">मण्डली — प्रभु, हम पर दया कर।</div>
          
          <p>धर्मसेवक — मसीह, हम पर दया कर।</p>
          <div class="congregation-part">मण्डली — मसीह, हम पर दया कर।</div>

          <p>धर्मसेवक — प्रभु, हम पर दया कर।</p>
          <div class="congregation-part">मण्डली — प्रभु, हम पर दया कर।</div>

          <p>अथवा — यह याचना तीन बार की जाए।</p>
          <p>धर्मसेवक — हे पवित्र परमेश्वर,</p>
          <div class="congregation-part">मण्डली — पवित्र और सामर्थी, पवित्र और अनन्तकालीन परमेश्वर, हम पर दया कर।</div>

          <p>6. धर्मसेवक अपने ही शब्दों में प्रार्थना करे।</p>
          <p>7. धर्मसेवक उस दिवस की विशेष प्रार्थना (कॉलेक्ट) पढ़ सकता है।</p>

          <hr class="border-slate-700 my-4">
          <h3 class="font-bold text-lg text-center">पवित्र वचन का पाठ</h3>

          <p>8. पुराने नियम से पाठ पढ़ाया जा सकता है।<br>पाठ के अन्त में यह कहा जा सकता है :<br>वाचक — यह परमेश्वर का वचन है।</p>
          <div class="congregation-part">मण्डली — परमेश्वर का धन्यवाद हो।</div>
          <p class="text-xs text-slate-400 italic">(मनन के लिये कुछ क्षण मौन।)</p>

          <p>9. भजन संहिता से एक भजन गाना या पढ़ना।</p>

          <p>10. पत्रियों से पाठ। पाठ के अन्त में यह कहा जा सकता है :<br>वाचक — यह परमेश्वर का वचन है।</p>
          <div class="congregation-part">मण्डली — परमेश्वर का धन्यवाद हो।</div>
          <p class="text-xs text-slate-400 italic">(मनन के लिये कुछ क्षण मौन।)</p>

          <p>11. स्तुतिगान, गीत या भजन संहिता से एक भजन।</p>

          <p>12. सुसमाचार पाठ।</p>
          <div class="congregation-part">मण्डली — हे यीशु मसीह, तेरी महिमा हो।</div>
          <p>वाचक — यह मसीह का सुसमाचार है।</p>
          <div class="congregation-part">मण्डली — हे प्रभु यीशु, तेरी स्तुति हो।</div>

          <p>13. उपदेश (संक्षिप्त आह्वान/प्रार्थना से आरम्भ)</p>

          <p>14. नीकया विश्वास-वचन</p>
          <div class="congregation-part">
            हम एक परमेश्वर सर्वशक्तिमान पिता पर विश्वास करते हैं।<br>
            वह स्वर्ग और पृथ्वी का<br>
            और समस्त दृश्य एवं अदृश्य वस्तुओं का कर्ता है।<br><br>
            
            हम एक प्रभु यीशु मसीह पर विश्वास करते हैं।<br>
            वह परमेश्वर का एकलौता पुत्र,<br>
            सदैवों से पहले पिता से उत्पन्न,<br>
            परमेश्वर से परमेश्वर, ज्योति से ज्योति,<br>
            सच्चे परमेश्वर से सच्चे परमेश्वर,<br>
            कृत नहीं, वरन् उत्पन्न है;<br>
            उसका और पिता का तत्व एक है।<br>
            उसी के द्वारा सब वस्तुएँ बनीं।<br>
            हम मनुष्यों के लिये और हमारे उद्धार के निमित्त<br>
            वह स्वर्ग से उतर आया।<br>
            पवित्र आत्मा के सामर्थ्य से<br>
            वह कुँवारी मरियम से जन्मा और मनुष्य बना।<br>
            पुन्तियुस पिलातुस के शासन में<br>
            वह हमारे लिये क्रूस पर चढ़ाया गया;<br>
            उसने दुःख भोगा, वह मरा और गाड़ा गया।<br>
            पवित्र शास्त्र के कथन के अनुसार<br>
            वह तीसरे दिन जी उठा।<br>
            वह स्वर्ग पर चढ़ गया,<br>
            और पिता के दाहिने ओर विराजमान है।<br>
            वह जीवितों और मृतकों का न्याय करने के लिये<br>
            महिमा के साथ फिर आयेगा,<br>
            और उसके राज्य का कभी अन्त न होगा।<br><br>

            हम पवित्र आत्मा पर विश्वास करते हैं।<br>
            वह प्रभु और जीवनदाता है।<br>
            वह पिता और पुत्र से निकलता है।<br>
            पिता और पुत्र के साथ<br>
            उसकी आराधना और स्तुति की जाती है।<br>
            वह नबियों के द्वारा बोला।<br>
            हम एक पवित्र सार्वत्रिक<br>
            और प्रेरितिक कलीसिया पर विश्वास करते हैं।<br>
            हम पापों की क्षमा के लिये<br>
            एक बपतिस्मे को मानते हैं।<br>
            हम मृतकों के पुनरुत्थान का<br>
            और आनेवाले युग के जीवन का प्रतीक्षा करते हैं। आमीन।
          </div>

          <p>अथवा (प्रेरितों का विश्वास-वचन)</p>

          <div class="congregation-part">
            मैं सर्वशक्तिमान पिता,<br>
            स्वर्ग और पृथ्वी के सृष्टिकर्ता<br>
            परमेश्वर पर विश्वास करता हूँ।<br><br>
            मैं उसके एकलौते पुत्र,<br>
            हमारे प्रभु यीशु मसीह पर विश्वास करता हूँ।<br>
            वह पवित्र आत्मा के सामर्थ्य से गर्भ में आया<br>
            और कुँवारी मरियम से जन्मा।<br>
            उसने पुन्तियुस पिलातुस के शासन में दुःख भोगा।<br>
            वह क्रूस पर चढ़ाया गया, मरा और गाड़ा गया;<br>
            और मृतकों के लोक में उतरा।<br>
            तीसरे दिन वह जी उठा।<br>
            वह स्वर्ग पर चढ़ गया<br>
            और पिता के दाहिने ओर विराजमान है।<br>
            वह जीवितों और मृतकों का न्याय करने को फिर आयेगा।<br><br>
            मैं पवित्र आत्मा पर,<br>
            पवित्र सार्वत्रिक कलीसिया पर,<br>
            संतों का सहभाग,<br>
            पापों का क्षमा,<br>
            देह के पुनरुत्थान<br>
            और अनन्त जीवन पर विश्वास करता हूँ। आमीन।
          </div>
        </div>
      </section>

      <section id="adminScreen" class="hidden space-y-4 text-sm">
        <h2 class="text-lg font-semibold flex items-center gap-2 text-pink-400">
          <i class="fa-solid fa-user-shield"></i>
          Admin Panel
        </h2>

        <div id="adminLoginBox" class="space-y-2">
          <p class="text-[0.7rem] text-slate-400">
            Enter admin PIN to manage songs. (Only for Worship App admin.)
          </p>
          <div class="flex gap-2 items-center">
            <input id="adminPinInput" type="password" maxlength="6" placeholder="Enter PIN"
              class="rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-xs focus:outline-none focus:ring-1 focus:ring-pink-500 tracking-[0.25em]" />
            <button id="adminLoginBtn" class="btn-primary text-xs px-3">
              Login
            </button>
          </div>
          <p id="adminLoginError" class="text-[0.7rem] text-red-400 hidden">
            Wrong PIN. Try again.
          </p>
        </div>

        <div id="adminContent" class="hidden space-y-4">
          <div class="border border-slate-700 rounded-2xl p-3 bg-slate-900/70 space-y-3">
            <div class="grid grid-cols-1 sm:grid-cols-4 gap-2">
              <div>
                <label class="text-[0.65rem] text-slate-400">Serial No.</label>
                <input id="adminSongSerial" type="number"
                  class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-2 py-1.5 text-xs focus:outline-none focus:ring-1 focus:ring-blue-500" />
              </div>
              <div class="sm:col-span-3">
                <label class="text-[0.65rem] text-slate-400">Hindi Title</label>
                <input id="adminSongTitleHindi" type="text"
                  class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-2 py-1.5 text-xs focus:outline-none focus:ring-1 focus:ring-blue-500 hindi-text" />
              </div>
            </div>

            <div>
              <label class="text-[0.65rem] text-slate-400">Hinglish Title</label>
              <input id="adminSongTitleHinglish" type="text"
                class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-2 py-1.5 text-xs focus:outline-none focus:ring-1 focus:ring-blue-500" />
            </div>

            <div>
              <label class="text-[0.65rem] text-slate-400">Hindi Lyrics</label>
              <textarea id="adminLyricsHindi" rows="5"
                class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-2 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-blue-500 hindi-text"></textarea>
            </div>

            <div class="flex gap-2">
              <button id="addSongBtn" class="btn-primary flex-1 text-xs">Save Song</button>
              <button id="updateSongBtn" class="btn-warning flex-1 text-xs hidden">Update Song</button>
              <button id="deleteSongBtn" class="btn-danger text-xs px-3 hidden">
                <i class="fa-solid fa-trash"></i>
              </button>
            </div>
            <p id="adminStatusMsg" class="text-[0.7rem] text-emerald-400 hidden"></p>
          </div>

          <div class="space-y-2">
            <div class="relative">
              <input id="adminSearchInput" type="text" placeholder="Search song to edit..."
                class="w-full rounded-xl bg-slate-900/80 border border-slate-700 px-3 py-2 text-xs focus:outline-none focus:ring-1 focus:ring-slate-500">
            </div>
            <p class="text-[0.65rem] text-slate-500">Click on a song below to edit:</p>
            <div id="adminSongList"
              class="max-h-[200px] overflow-y-auto scrollbar-thin space-y-1 border border-slate-800 rounded-xl p-1">
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer
      class="text-[0.7rem] text-slate-500 text-center mt-8 pb-6 border-t border-slate-700/40 pt-4">
      Worship App • Designed & Developed by
      <span class="text-blue-400 font-semibold">Abhishek Masih</span><br>
      © 2025 All Rights Reserved
    </footer>
  </div>

  <div class="fixed bottom-6 right-3 flex flex-col gap-3 z-50">
    <button onclick="changeFontSize(1)" 
      class="w-10 h-10 rounded-full bg-slate-700/90 text-white border border-slate-500 shadow-xl flex items-center justify-center active:scale-90 hover:bg-blue-600 transition">
      <i class="fa-solid fa-plus"></i>
    </button>
    <button onclick="changeFontSize(-1)" 
      class="w-10 h-10 rounded-full bg-slate-700/90 text-white border border-slate-500 shadow-xl flex items-center justify-center active:scale-90 hover:bg-blue-600 transition">
      <i class="fa-solid fa-minus"></i>
    </button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

  <script>
    // ========== FIREBASE CONFIG ==========
    const firebaseConfig = {
      apiKey: "AIzaSyCbn4wCltG1YrrfmUeoOmOvzzQsyxZVkhY",
      authDomain: "worship-3eedf.firebaseapp.com",
      projectId: "worship-3eedf",
      storageBucket: "worship-3eedf.firebasestorage.app",
      messagingSenderId: "1000732372247",
      appId: "1:1000732372247:web:ec746fc5db5dabd35a1b52"
    };

    let db;
    let app;

    try {
      app = firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
    } catch (e) {
      console.error("Firebase initialization error:", e);
    }

    // ========== DOM ELEMENTS ==========
    const tabs = document.querySelectorAll('.tab-btn');
    const screens = {
      home: document.getElementById('homeScreen'),
      songDetail: document.getElementById('songDetailScreen'),
      aradhana: document.getElementById('aradhanaScreen'),
      prabhuBhoj: document.getElementById('prabhuBhojScreen'),
      admin: document.getElementById('adminScreen')
    };

    const searchInput = document.getElementById('searchInput');
    const favoriteToggle = document.getElementById('favoriteToggle');
    const songList = document.getElementById('songList');

    // Song detail
    const songDetailScreen = screens.songDetail;
    const songSerialEl = document.getElementById('songSerial').querySelector('span');
    const songTitleHindiEl = document.getElementById('songTitleHindi');
    const songTitleHinglishEl = document.getElementById('songTitleHinglish');
    const lyricsContainer = document.getElementById('lyricsContainer');
    const favoriteSongBtn = document.getElementById('favoriteSongBtn');
    const backToListBtn = document.getElementById('backToListBtn');

    // Prabhu Bhoj content
    const prabhuBhojContent = document.getElementById('prabhuBhojContent');

    // Admin
    const adminScreen = screens.admin;
    const adminLoginBox = document.getElementById('adminLoginBox');
    const adminContent = document.getElementById('adminContent');
    const adminPinInput = document.getElementById('adminPinInput');
    const adminLoginBtn = document.getElementById('adminLoginBtn');
    const adminLoginError = document.getElementById('adminLoginError');

    const adminSongSerial = document.getElementById('adminSongSerial');
    const adminSongTitleHindi = document.getElementById('adminSongTitleHindi');
    const adminSongTitleHinglish = document.getElementById('adminSongTitleHinglish');
    const adminLyricsHindi = document.getElementById('adminLyricsHindi');
    const addSongBtn = document.getElementById('addSongBtn');
    const updateSongBtn = document.getElementById('updateSongBtn');
    const deleteSongBtn = document.getElementById('deleteSongBtn');
    const adminStatusMsg = document.getElementById('adminStatusMsg');
    const adminSearchInput = document.getElementById('adminSearchInput');
    const adminSongList = document.getElementById('adminSongList');

    // Theme / PWA
    const themeToggleBtn = document.getElementById('themeToggleBtn');
    const installPwaButton = document.getElementById('installPwaButton');

    // ========== GLOBAL STATE ==========
    let allSongs = [];
    let filteredSongs = [];
    let currentSong = null;
    let isAdmin = false;
    let editingSongId = null;

    const FAVORITES_KEY = 'worship_favorites_v1';
    const THEME_KEY = 'worship_theme';

    // ========== FONT SIZE LOGIC ==========
    let currentZoom = 100; // Default 100%

    function changeFontSize(direction) {
      // Limit: Min 80%, Max 160%
      if (direction === 1 && currentZoom < 160) {
        currentZoom += 10;
      } else if (direction === -1 && currentZoom > 80) {
        currentZoom -= 10;
      }
      // Applies to the entire HTML (because Tailwind uses rems)
      document.documentElement.style.fontSize = currentZoom + '%';
    }

    // ========== THEME LOGIC ==========
    function applyTheme(theme) {
      if (theme === 'light') {
        document.body.classList.add('light-mode');
        themeToggleBtn.innerHTML = '<i class="fa-solid fa-sun text-yellow-500"></i><span>Light</span>';
      } else {
        document.body.classList.remove('light-mode');
        themeToggleBtn.innerHTML = '<i class="fa-solid fa-moon text-slate-100"></i><span>Dark</span>';
      }
    }

    function initTheme() {
      const saved = localStorage.getItem(THEME_KEY) || 'dark';
      applyTheme(saved);
    }

    if (themeToggleBtn) {
      themeToggleBtn.addEventListener('click', () => {
        const isLight = document.body.classList.contains('light-mode');
        const next = isLight ? 'dark' : 'light';
        localStorage.setItem(THEME_KEY, next);
        applyTheme(next);
      });
    }

    initTheme();

    // ========== TABS / SCREENS ==========
    function showScreen(key) {
      Object.entries(screens).forEach(([name, el]) => {
        if (!el) return;
        if (name === key) {
          el.classList.remove('hidden');
        } else {
          el.classList.add('hidden');
        }
      });

      tabs.forEach(btn => {
        const target = btn.getAttribute('data-screen');
        if (target === key) {
          btn.classList.add('bg-slate-100', 'text-slate-900');
          btn.classList.remove('text-slate-200');
        } else {
          btn.classList.remove('bg-slate-100', 'text-slate-900');
          btn.classList.add('text-slate-200');
        }
      });
      
      // Scroll to top when switching screens
      window.scrollTo(0,0);
    }

    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        const screen = btn.getAttribute('data-screen');
        if (screen === 'home') showScreen('home');
        if (screen === 'aradhana') showScreen('aradhana');
        if (screen === 'prabhuBhoj') showScreen('prabhuBhoj');
        if (screen === 'admin') showScreen('admin');
      });
    });

    // default
    showScreen('home');

    // ========== FAVORITES HELPERS ==========
    function getFavoriteIds() {
      try {
        const raw = localStorage.getItem(FAVORITES_KEY);
        if (!raw) return [];
        const arr = JSON.parse(raw);
        if (Array.isArray(arr)) return arr;
      } catch (e) { }
      return [];
    }

    function setFavoriteIds(ids) {
      localStorage.setItem(FAVORITES_KEY, JSON.stringify(ids));
    }

    function isFavorite(id) {
      return getFavoriteIds().includes(id);
    }

    function toggleFavorite(id) {
      const ids = getFavoriteIds();
      const idx = ids.indexOf(id);
      if (idx === -1) ids.push(id);
      else ids.splice(idx, 1);
      setFavoriteIds(ids);
      return ids.includes(id);
    }

    // ========== SONGS LOAD ==========
    async function loadSongs() {
      if (!db) {
        console.error('Firestore not initialised');
        songList.innerHTML = '<p class="text-xs text-red-400 text-center mt-6">Error: Firestore not initialised.</p>';
        return;
      }
      try {
        const snap = await db.collection('songs').orderBy('serialNumber').get();
        allSongs = snap.docs.map(d => ({
          id: d.id,
          ...d.data()
        }));
        applyFilters();
      } catch (err) {
        console.error('Error loading songs', err);
        songList.innerHTML = '<p class="text-xs text-red-400 text-center mt-6">Failed to load songs.</p>';
      }
    }

    function applyFilters() {
      const q = (searchInput.value || '').trim().toLowerCase();
      const favOnly = favoriteToggle.classList.contains('active-fav');

      filteredSongs = allSongs.filter(song => {
        const num = (song.serialNumber || '').toString();
        const h = (song.title_hindi || '').toLowerCase();
        const he = (song.title_hinglish || '').toLowerCase();
        const lyr = (song.lyrics_hindi || '').toLowerCase();

        let ok = true;

        if (q) {
          ok =
            num.includes(q) ||
            h.includes(q) ||
            he.includes(q) ||
            lyr.includes(q);
        }

        if (favOnly) {
          ok = ok && isFavorite(song.id);
        }

        return ok;
      });

      renderSongList();
    }

    function renderSongList() {
      if (!songList) return;
      if (!allSongs.length) {
        songList.innerHTML = '<p class="text-xs text-slate-400 text-center mt-10">No songs found. Ask admin to add songs.</p>';
        return;
      }
      if (!filteredSongs.length) {
        songList.innerHTML = '<p class="text-xs text-slate-400 text-center mt-10">No song matches this search.</p>';
        return;
      }

      const favIds = getFavoriteIds();
      songList.innerHTML = '';
      filteredSongs.forEach(song => {
        const li = document.createElement('button');
        li.className = 'w-full flex items-start gap-3 px-3 py-3 rounded-2xl bg-slate-900/70 hover:bg-slate-800/80 border border-slate-800 text-left transition';
        li.innerHTML = `
          <div class="mt-0.5">
            <span class="badge-pill flex items-center gap-1">
              <i class="fa-solid fa-hashtag text-[9px]"></i>
              <span>${song.serialNumber ?? ''}</span>
            </span>
          </div>
          <div class="flex-1 min-w-0">
            <p class="hindi-text text-sm font-bold truncate text-slate-200">${song.title_hindi || 'Untitled'}</p>
            <p class="text-[0.7rem] text-slate-400 truncate">${song.title_hinglish || ''}</p>
          </div>
          <div class="flex flex-col items-end gap-1">
            <i class="${favIds.includes(song.id) ? 'fa-solid' : 'fa-regular'} fa-star text-[12px] ${favIds.includes(song.id) ? 'text-yellow-400' : 'text-slate-500'}"></i>
          </div>
        `;
        li.addEventListener('click', () => openSongDetail(song.id));
        songList.appendChild(li);
      });
    }

    function openSongDetail(id) {
      const song = allSongs.find(s => s.id === id);
      if (!song) return;
      currentSong = song;
      songSerialEl.textContent = song.serialNumber ?? '';
      songTitleHindiEl.textContent = song.title_hindi || '';
      songTitleHinglishEl.textContent = song.title_hinglish || '';
      renderLyrics();
      updateFavoriteButton(isFavorite(song.id));
      showScreen('songDetail');
    }

    function renderLyrics() {
      if (!currentSong) return;
      let text = currentSong.lyrics_hindi || '';
      if (!text) text = 'Lyrics not available.';
      lyricsContainer.textContent = text;
    }

    function updateFavoriteButton(isFav) {
      favoriteSongBtn.classList.toggle('text-yellow-300', isFav);
      favoriteSongBtn.classList.toggle('text-slate-200', !isFav);
      favoriteSongBtn.innerHTML = `<i class="${isFav ? 'fa-solid' : 'fa-regular'} fa-star"></i><span>${isFav ? 'Favourite' : 'Favourite'}</span>`;
    }

    // Back from song detail
    if (backToListBtn) {
      backToListBtn.addEventListener('click', () => {
        showScreen('home');
      });
    }

    // Favourite from detail
    if (favoriteSongBtn) {
      favoriteSongBtn.addEventListener('click', () => {
        if (!currentSong) return;
        const nowFav = toggleFavorite(currentSong.id);
        updateFavoriteButton(nowFav);
        applyFilters();
      });
    }

    // Search & Favourites filter
    if (searchInput) {
      searchInput.addEventListener('input', () => {
        applyFilters();
      });
    }

    if (favoriteToggle) {
      favoriteToggle.addEventListener('click', () => {
        favoriteToggle.classList.toggle('active-fav');
        const isOn = favoriteToggle.classList.contains('active-fav');
        const icon = favoriteToggle.querySelector('i');
        if (isOn) {
          favoriteToggle.classList.add('bg-yellow-500/10', 'border-yellow-400');
          if (icon) icon.classList.replace('fa-regular', 'fa-solid');
        } else {
          favoriteToggle.classList.remove('bg-yellow-500/10', 'border-yellow-400');
          if (icon) icon.classList.replace('fa-solid', 'fa-regular');
        }
        applyFilters();
      });
    }

    loadSongs();

    // ========== ADMIN LOGIC ==========
    const ADMIN_PIN = '1844';

    function updateAdminUI() {
      if (isAdmin) {
        adminLoginBox.classList.add('hidden');
        adminContent.classList.remove('hidden');
        renderAdminSongList();
      } else {
        adminLoginBox.classList.remove('hidden');
        adminContent.classList.add('hidden');
      }
    }

    function showAdminStatus(msg, isError = false) {
      adminStatusMsg.textContent = msg;
      adminStatusMsg.classList.remove('hidden');
      adminStatusMsg.classList.toggle('text-red-400', isError);
      adminStatusMsg.classList.toggle('text-emerald-400', !isError);
      setTimeout(() => { adminStatusMsg.classList.add('hidden'); }, 3000);
    }

    if (adminLoginBtn) {
      adminLoginBtn.addEventListener('click', () => {
        if (adminPinInput.value.trim() === ADMIN_PIN) {
          isAdmin = true;
          adminLoginError.classList.add('hidden');
          updateAdminUI();
        } else {
          adminLoginError.classList.remove('hidden');
        }
      });
    }

    function clearAdminForm() {
      editingSongId = null;
      adminSongSerial.value = '';
      adminSongTitleHindi.value = '';
      adminSongTitleHinglish.value = '';
      adminLyricsHindi.value = '';
      addSongBtn.classList.remove('hidden');
      updateSongBtn.classList.add('hidden');
      deleteSongBtn.classList.add('hidden');
    }

    function fillAdminForm(song) {
      editingSongId = song.id;
      adminSongSerial.value = song.serialNumber ?? '';
      adminSongTitleHindi.value = song.title_hindi || '';
      adminSongTitleHinglish.value = song.title_hinglish || '';
      adminLyricsHindi.value = song.lyrics_hindi || '';
      addSongBtn.classList.add('hidden');
      updateSongBtn.classList.remove('hidden');
      deleteSongBtn.classList.remove('hidden');
    }

    function renderAdminSongList() {
      const query = (adminSearchInput.value || '').toLowerCase();
      adminSongList.innerHTML = '';

      const listToRender = allSongs.filter(song => {
        const num = (song.serialNumber || '').toString();
        const h = (song.title_hindi || '').toLowerCase();
        return num.includes(query) || h.includes(query);
      });

      if (!listToRender.length) {
        adminSongList.innerHTML = '<p class="text-[0.65rem] text-slate-500 text-center p-2">No songs found.</p>';
        return;
      }

      listToRender.forEach(song => {
        const btn = document.createElement('button');
        btn.className = 'w-full text-left text-[0.7rem] px-2 py-1.5 rounded-xl hover:bg-slate-800/70 flex items-center justify-between';
        btn.innerHTML = `
          <span class="flex items-center gap-2">
            <span class="badge-pill"><span>#${song.serialNumber ?? ''}</span></span>
            <span class="hindi-text truncate max-w-[180px]">${song.title_hindi || ''}</span>
          </span>
          <i class="fa-solid fa-pen-to-square text-slate-400 text-[10px]"></i>
        `;
        btn.addEventListener('click', () => {
          fillAdminForm(song);
        });
        adminSongList.appendChild(btn);
      });
    }

    if (adminSearchInput) {
      adminSearchInput.addEventListener('input', () => {
        renderAdminSongList();
      });
    }

    if (addSongBtn) {
      addSongBtn.addEventListener('click', async () => {
        if (!db) return;
        const serial = parseInt(adminSongSerial.value || '0', 10);
        const h = adminSongTitleHindi.value.trim();
        const he = adminSongTitleHinglish.value.trim();
        const lyr = adminLyricsHindi.value.trim();

        if (!serial || !h || !lyr) {
          showAdminStatus('Serial, Hindi title aur lyrics required hain.', true);
          return;
        }

        try {
          await db.collection('songs').add({
            serialNumber: serial,
            title_hindi: h,
            title_hinglish: he,
            lyrics_hindi: lyr
          });
          showAdminStatus('Song saved successfully.');
          clearAdminForm();
          await loadSongs();
          renderAdminSongList();
        } catch (e) {
          console.error(e);
          showAdminStatus('Error saving song.', true);
        }
      });
    }

    if (updateSongBtn) {
      updateSongBtn.addEventListener('click', async () => {
        if (!db || !editingSongId) return;

        const serial = parseInt(adminSongSerial.value || '0', 10);
        const h = adminSongTitleHindi.value.trim();
        const he = adminSongTitleHinglish.value.trim();
        const lyr = adminLyricsHindi.value.trim();

        if (!serial || !h || !lyr) {
          showAdminStatus('Serial, Hindi title aur lyrics required hain.', true);
          return;
        }

        try {
          await db.collection('songs').doc(editingSongId).update({
            serialNumber: serial,
            title_hindi: h,
            title_hinglish: he,
            lyrics_hindi: lyr
          });
          showAdminStatus('Song updated successfully.');
          clearAdminForm();
          await loadSongs();
          renderAdminSongList();
        } catch (e) {
          console.error(e);
          showAdminStatus('Error updating song.', true);
        }
      });
    }

    if (deleteSongBtn) {
      deleteSongBtn.addEventListener('click', async () => {
        if (!db || !editingSongId) return;
        if (!confirm('Delete this song permanently?')) return;

        try {
          await db.collection('songs').doc(editingSongId).delete();
          showAdminStatus('Song deleted.');
          clearAdminForm();
          await loadSongs();
          renderAdminSongList();
        } catch (e) {
          console.error(e);
          showAdminStatus('Error deleting song.', true);
        }
      });
    }

    updateAdminUI();

    // ========== PWA INSTALL BUTTON LOGIC ==========
    let deferredPrompt = null;
    const INSTALL_KEY = 'pwaInstalled';

    function isAppStandalone() {
      return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    }

    function hideInstallButton() {
      if (installPwaButton) installPwaButton.classList.add('hidden');
    }

    function showInstallButton() {
      if (!installPwaButton) return;
      if (isAppStandalone()) { hideInstallButton(); return; }
      if (localStorage.getItem(INSTALL_KEY) === 'yes') { hideInstallButton(); return; }
      installPwaButton.classList.remove('hidden');
    }

    if (isAppStandalone() || localStorage.getItem(INSTALL_KEY) === 'yes') {
      hideInstallButton();
    }

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallButton();
    });

    window.addEventListener('appinstalled', () => {
      localStorage.setItem(INSTALL_KEY, 'yes');
      hideInstallButton();
    });

    if (installPwaButton) {
      installPwaButton.addEventListener('click', async () => {
        if (!deferredPrompt) {
          alert("To Install:\nBrowser menu (⋮) > 'Install App' or 'Add to Home Screen'");
          return;
        }
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          localStorage.setItem(INSTALL_KEY, 'yes');
          hideInstallButton();
        }
        deferredPrompt = null;
      });
    }

    // ========== SERVICE WORKER REGISTER ==========
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(err => {
          console.error('SW registration failed', err);
        });
      });
    }
  </script>
</body>

</html>